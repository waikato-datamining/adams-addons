% Copyright (c) 2023 by the University of Waikato, Hamilton, NZ.
% This work is made available under the terms of the 
% Creative Commons Attribution-ShareAlike 4.0 license,
% http://creativecommons.org/licenses/by-sa/4.0/.

\documentclass[a4paper]{book}

\usepackage{wrapfig}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{multirow}
\usepackage{scalefnt}
\usepackage{tikz}

% watermark -- for draft stage
%\usepackage[firstpage]{draftwatermark}
%\SetWatermarkLightness{0.9}
%\SetWatermarkScale{5}

\input{latex_extensions}

\title{
  \textbf{ADAMS} \\
  {\Large \textbf{A}dvanced \textbf{D}ata mining \textbf{A}nd \textbf{M}achine
  learning \textbf{S}ystem} \\
  {\Large Module: adams-docker} \\
  \vspace{1cm}
  \includegraphics[width=2cm]{images/docker-module.png} \\
}
\author{
  Peter Reutemann
}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\begin{document}

\begin{titlepage}
\maketitle

\thispagestyle{empty}
\center
\begin{table}[b]
	\begin{tabular}{c l l}
		\parbox[c][2cm]{2cm}{\copyright 2023} &
		\parbox[c][2cm]{5cm}{\includegraphics[width=5cm]{images/coat_of_arms.pdf}} \\
	\end{tabular}
	\includegraphics[width=12cm]{images/cc.png} \\
\end{table}

\end{titlepage}

\tableofcontents
\listoffigures
%\listoftables

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
Docker\cite{docker} offers OS-level virtualization for software using containers.
This allows the encapsulation of software that would otherwise interfer with each
other.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Flow}
The following standalones are available:
\begin{tight_itemize}
  \item \textit{SimpleDockerConnection} -- determines the context in which to run the docker commands, e.g., what docker registry to use.
\end{tight_itemize}

\noindent The following sources are available:
\begin{tight_itemize}
  \item \textit{SimpleDockerCommand} -- executes the selected docker command plugin, requires presence of a
  \textit{SimpleDockerConnection} (see \ref{simpledockercommands}).
\end{tight_itemize}

\noindent The following transformers are available:
\begin{tight_itemize}
  \item \textit{SimpleDockerCommand} -- passes the incoming data as additional arguments to the selected docker
  command plugin, requires presence of a \textit{SimpleDockerConnection} (see \ref{simpledockercommands}).
\end{tight_itemize}

\noindent The following conversions are available:
\begin{tight_itemize}
  \item \textit{LocalPathToContainerPath} -- using the directory mappings defined by a \textit{SimpleDockerConnection},
  the local path passing through gets converted into one to be used within the container.
\end{tight_itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simple docker commands}
\label(simpledockercommands)
The following source commands are supported:
\begin{tight_itemize}
  \item \textit{BuildImage} -- for building an image (\texttt{docker image build})
  \item \textit{ExecContainer} -- for executing a command in a running container (\texttt{docker container exec})
  \item \textit{Generic} -- for running an arbitrary docker sub-command
  \item \textit{Info} -- outputs information about the docker environment (\texttt{docker info})
  \item \textit{ListContainers} -- lists container IDs (\texttt{docker container ls})
  \item \textit{ListImages} -- lists image IDs (\texttt{docker image ls})
  \item \textit{PruneContainers} -- prunes containers (\texttt{docker container prune})
  \item \textit{PruneImages} -- prunes images (\texttt{docker image prune})
  \item \textit{Pull} -- pulls a specific image (\texttt{docker pull})
  \item \textit{Push} -- pushes the specified image (\texttt{docker push})
  \item \textit{Run} -- executes the specified image (\texttt{docker run})
\end{tight_itemize}
The following transformer commands are supported:
\begin{tight_itemize}
  \item \textit{GenericWithArgs} -- generic command that takes additional arguments as input (appended to command)
  \item \textit{KillContainers} -- kills the specified containers (\texttt{docker container kill})
  \item \textit{PauseContainers} -- pauses the specified containers (\texttt{docker container pause})
  \item \textit{RemoveContainers} -- for removing conatiners (\texttt{docker container rm})
  \item \textit{RemoveImages} -- for removing images (\texttt{docker image rm})
  \item \textit{RunWithArgs} -- like \textit{Run}, but appends the incoming arguments to the command
  \item \textit{StartContainers} -- for starting containers (\texttt{docker container start})
  \item \textit{StopContainers} -- stops the specified containers (\texttt{docker container stop})
\end{tight_itemize}
Some of the commands can be run in either \textit{blocking} or \textit{asynchronous} mode. The former waits till
the command finishes and then forwards the collected output from stdout (recommended for quick commands). The latter
forwards the output being generated by the command as it happens (recommended for long-running commands like pulling
or building).

\noindent The following plugins can be used for handling output received from stderr while running a docker command:
\begin{tight_itemize}
  \item \textit{CallableActorSink} -- sends the output to the specified callable sink.
  \item \textit{Enqueue} -- adds the output to the specified queue in internal storage.
  \item \textit{Log} -- uses its logger instance to print the output.
  \item \textit{Null} -- ignores any output.
\end{tight_itemize}

\noindent \textbf{NB:} When needing to start multiple Docker containers in a single flow, but still monitoring
the output that they are generating (i.e., in blocking fashion), then the \textit{LaunchTee} or \textit{LaunchTrigger}
control actor can be used to wrap the Docker command.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{bibliography}

\end{document}
