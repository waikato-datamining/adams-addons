# adams-rats-django

Simple Django framework for managing Rat actors accessible via a RatControl
using a REST webservice.

In order to be able to remote control Rat actors, you need to:

* have a *RegisterFlow* standalone in your flow
* have a *RatControl* standalone in your flow
* all the *Rat* actors that should be remote controllable, need to have their
  *showInControl* flag set
* have a *RESTServer* standalone with the *GenericServer* configured; the
  *GenericServer* must list at least the *RatControl* rest plugin.

Example flow for testing:

[adams-addons-all:adams-addons-all-rest_rats.flow](https://github.com/waikato-datamining/adams-applications/blob/master/adams-addons-all/src/main/flows/adams-addons-all-rest_rats.flow)


## Installation

* Requirements

  * Python 3.8+
  * virtualenv
  
* Uses

  * [jinja2](http://jinja.pocoo.org/)
  * [requests](http://docs.python-requests.org/en/master/)

* Steps (for Linux)

  * install Python
  * decompress adams-rats-django archive
  * change into `adams-rats-django` directory
  * set up virtual environment (above directory with `requirements.txt`)

    ```commandline
    virtualenv -p /usr/bin/python3 venv
    ```
  
  * install Django and required dependencies (change into dir with `requirements.txt`)

    ```commandline
    ../venv/bin/pip install -r requirements.txt
    ```

  * configure custom settings (`adams_rats_django/settings_custom.py`):
    
      * ADAMS database settings:
    
        ```python
        DEBUG = False
        PRODUCTION = True
        LOGIN_REQUIRED = False # change to True for outward facing website
        ```
        
      * the URL that is used to remote control the Rat actors:
    
        ```python
        REMOTECONTROL_HOST = "http://localhost:8081/"
        ```
        
      * configure logging
      
        ```python
        LOGGING_DEFAULT_HANDLERS_CONFIG = {
            'console': {
                'class': 'logging.StreamHandler',
                'formatter': 'default',
            },
            'file': {
                'class': 'logging.handlers.RotatingFileHandler',
                'filename': '/tmp/adams-rats.log',
                'formatter': 'default',
                'maxBytes': 1024*1024*50,   # 50 MB
                'backupCount': 5,
            },
        }
        LOGGING_DEFAULT_HANDLERS_LIST = ['console', 'file']
        LOGGING_DEFAULT_LEVEL = 'WARNING'
        ```

      * Define the `RESTART_COMMAND` (replace `None` with a suitable command to restart the ADAMS backend):

        ```python
        RESTART_COMMAND = None
        ```


* Steps (for Windows)

  * install Python
  * decompress adams-rats-django archive
  * change into `adams-rats-django` directory
  * set up virtual environment (above directory with `requirements.txt`)

    ```commandline
    virtualenv -p C:\Python38\python.exe venv
    ```

  * install Django and required dependencies (change into dir with `requirements.txt`)

    ```commandline
    ..\venv\Scripts\pip install -r requirements.txt
    ```

  * configure custom settings(`adams_rats_django\settings_custom.py`)
    
      * ADAMS database settings:
    
        ```python
        DEBUG = False
        PRODUCTION = True
        LOGIN_REQUIRED = False # change to True for outward facing website
        ```
        
      * the URL that is used to remote control the Rat actors:
    
        ```python
        REMOTECONTROL_HOST = "http://localhost:8081/"
        ```
        
      * configure logging
      
        ```python
        LOGGING_DEFAULT_HANDLERS_CONFIG = {
            'console': {
                'class': 'logging.StreamHandler',
                'formatter': 'default',
            },
            'file': {
                'class': 'logging.handlers.RotatingFileHandler',
                'filename': 'C:/somewhere/adams-rats.log',
                'formatter': 'default',
                'maxBytes': 1024*1024*50,   # 50 MB
                'backupCount': 5,
            },
        }
        LOGGING_DEFAULT_HANDLERS_LIST = ['console', 'file']
        LOGGING_DEFAULT_LEVEL = 'WARNING'
        ```

      * Define the `RESTART_COMMAND` (replace `None` with a suitable command to restart the ADAMS backend):

        ```python
        RESTART_COMMAND = None
        ```


## Usage

### Development

* change into project directory
* change into `adams_rats_django`
* initialize the database (Linux)

  ```bash
  ./venv/bin/python adams-rats-django/manage.py migrate
  ```

* initialize the database (Windows)

  ```bash
  .\venv\Scripts\python.exe adams-rats-django\manage.py migrate
  ```

* start up local webserver (Linux)

  ```bash
  ./venv/bin/python adams-rats-django/manage.py runserver
  ```

* start up local webserver (Windows)

  ```commandline
  .\venv\Scripts\python.exe adams-rats-django\manage.py runserver --noreload
  ```
  
  **NB:** `--noreload` is used to avoid `is being used by another process` exceptions
  generated by the `RotatingFileHandler` log handler (see [stackoverflow](https://stackoverflow.com/a/23420005/4698227)).

* open webbrowser at http://localhost:8000/

* if you want to serve it outside localhost, then you need to add `0.0.0.0:8000` 
  to the command-line.


### Production

Use the django application through WSGI

* [Linux](https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-apache-and-mod_wsgi-on-ubuntu-14-04)
* [Windows](http://blog.mattwoodward.com/2016/07/running-django-application-on-windows.html) 


## Authentication

If `LOGIN_REQUIRED` is set to `True` you need to create users. First step is to create a superuser, 
which then can be used to create and configure other users.

* run the following command to create superuser (Linux)

  ```commandline
  ./venv/bin/python adams-rats-django/manage.py createsuperuser --username=<name> --email=<email>
  ```

* run the following command to create superuser (Windows)

  ```commandline
  .\venv\Scripts\python.exe adams-rats-django\manage.py createsuperuser --username=<name> --email=<email>
  ```

* after that you can manage users with the admin interface at http://localhost:8000/admin 
